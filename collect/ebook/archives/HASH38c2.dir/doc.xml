<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE Archive SYSTEM "http://greenstone.org/dtd/Archive/1.0/Archive.dtd">
<Archive>
<Section>
  <Description>
    <Metadata name="gsdldoctype">indexed_doc</Metadata>
    <Metadata name="Language">en</Metadata>
    <Metadata name="Encoding">utf8</Metadata>
    <Metadata name="Title">Greenstone tutorial exercise</Metadata>
    <Metadata name="URL">http://C:/Program Files/Greenstone/tmp/F215.html</Metadata>
    <Metadata name="UTF8URL">http://C:/Program Files/Greenstone/tmp/F215.html</Metadata>
    <Metadata name="gsdlsourcefilename">import\Enhanced PDF handling.pdf</Metadata>
    <Metadata name="gsdlconvertedfilename">C:\Program Files\Greenstone\tmp\F215.html</Metadata>
    <Metadata name="OrigSource">F215.html</Metadata>
    <Metadata name="Source">Enhanced PDF handling.pdf</Metadata>
    <Metadata name="SourceFile">Enhanced PDF handling.pdf</Metadata>
    <Metadata name="Plugin">PDFPlugin</Metadata>
    <Metadata name="FileSize">242329</Metadata>
    <Metadata name="FilenameRoot">Enhanced PDF handling</Metadata>
    <Metadata name="FileFormat">PDF</Metadata>
    <Metadata name="srcicon">_iconpdf_</Metadata>
    <Metadata name="srclink_file">doc.pdf</Metadata>
    <Metadata name="srclinkFile">doc.pdf</Metadata>
    <Metadata name="NumPages">4</Metadata>
    <Metadata name="ex.ExifTool.ExifToolVersion">8.57</Metadata>
    <Metadata name="ex.File.Directory">C:\Program Files\Greenstone\collect\ebook\import</Metadata>
    <Metadata name="ex.File.FileModifyDate">2018:12:17 09:16:26-08:00</Metadata>
    <Metadata name="ex.File.FileName">Enhanced PDF handling.pdf</Metadata>
    <Metadata name="ex.File.FilePermissions">666</Metadata>
    <Metadata name="ex.File.FileSize">242329</Metadata>
    <Metadata name="ex.File.FileType">PDF</Metadata>
    <Metadata name="ex.File.MIMEType">application/pdf</Metadata>
    <Metadata name="ex.PDF.CreateDate">2018:11:13 11:29:12+00:00</Metadata>
    <Metadata name="ex.PDF.Creator">Mozilla/5.0 &amp;#40;Windows NT 6.3; Win64; x64&amp;#41; AppleWebKit/537.36 &amp;#40;KHTML&amp;#44; like Gecko&amp;#41; Chrome/70.0.3538.77 Safari/537.36</Metadata>
    <Metadata name="ex.PDF.Linearized">false</Metadata>
    <Metadata name="ex.PDF.ModifyDate">2018:11:13 11:29:12+00:00</Metadata>
    <Metadata name="ex.PDF.PDFVersion">1.4</Metadata>
    <Metadata name="ex.PDF.PageCount">4</Metadata>
    <Metadata name="ex.PDF.Producer">Skia/PDF m70</Metadata>
    <Metadata name="Identifier">HASH38c2e1486c5e0bb50f9bbf</Metadata>
    <Metadata name="lastmodified">1545066986</Metadata>
    <Metadata name="lastmodifieddate">20181217</Metadata>
    <Metadata name="oailastmodified">1545141368</Metadata>
    <Metadata name="oailastmodifieddate">20181218</Metadata>
    <Metadata name="assocfilepath">HASH38c2.dir</Metadata>
    <Metadata name="gsdlassocfile">doc.pdf:application/pdf:</Metadata>
  </Description>
  <Content>
&lt;a name=0&gt;&lt;/a&gt;&lt;div style=&quot;page-break-before:always; page-break-after:always&quot;&gt;&lt;div&gt;&lt;p&gt;11/13/2018 Enhanced PDF handling&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;http://files.greenstone.org/tutorial/gs2-current/en/enhanced_pdf.htm 1/4&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;Greenstone tutorial exercise&lt;br /&gt;Back to wiki &lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt; Back to index &lt;br /&gt; Sample files: Word_and_PDF.zip &lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;Devised for Greenstone version: 2.70|3.06&lt;br /&gt; Modified for Greenstone version: 2.87|3.08&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;Enhanced PDF handling&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;Greenstone converts PDF files to HTML using third-party software: pdftohtml.pl. This lets users view these documents even if they don't have the&lt;br /&gt;PDF software installed. Unfortunately, sometimes the formatting of the resulting HTML files is not so good. This exercise explores some extra&lt;br /&gt;options to the PDF plugin which may produce a nicer version for display.&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;1. In the Librarian Interface, start a new collection called &amp;quot;PDF collection&amp;quot; and base it on -- New Collection --.&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;In the Gather panel, drag just the PDF documents from sample_files → Word_and_PDF → Documents into the new collection. Also drag in&lt;br /&gt;the PDF documents from sample_files → Word_and_PDF → difficult_pdf.&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;Go to the Create panel and build the collection. Examine the output from the build process. You will notice that one of the documents could not&lt;br /&gt;be processed. The following messages are shown: &amp;quot;The file pdf05-notext.pdf was recognised but could not be processed by any plugin.&amp;quot;, and &amp;quot;3&lt;br /&gt;documents were processed and included in the collection. 1 was rejected&amp;quot;.&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;2. Preview the collection and view the documents. pdf05-notext.pdf does not appear as it could not be processed. pdf06-weirdchars.pdf was&lt;br /&gt;processed but looks very strange. The other PDF documents appear as one long document, with no sections.&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;Modes in the Librarian Interface&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;The Librarian Interface can operate in different modes. The default mode is Librarian mode. We can use Expert mode to work out why the pdf file&lt;br /&gt;could not be processed.&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;3. Use the Preferences... item on the File menu, Mode tab, to switch to Expert mode and then build the collection again. The Create panel looks&lt;br /&gt;different in Expert mode because it gives more options: locate the &amp;lt;Build Collection&amp;gt; button, near the bottom of the window, and click it.&lt;br /&gt;Now a message appears saying that the file could not be processed, and why. Amongst all the output, we get the following message: &amp;quot;Error:&lt;br /&gt;PDF contains no extractable text. Could not convert pdf05-notext.pdf to HTML format&amp;quot;. pdftohtml.pl cannot convert a PDF file to HTML if the&lt;br /&gt;PDF file has no extractable text.&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;4. We recommend that you switch back to Librarian mode for subsequent exercises, to avoid confusion.&lt;/p&gt;&lt;br /&gt;&lt;br /&gt;&lt;/div&gt;&lt;/div&gt;&lt;br /&gt;&lt;a name=0&gt;&lt;/a&gt;&lt;div style=&quot;page-break-before:always; page-break-after:always&quot;&gt;&lt;div&gt;&lt;p&gt;11/13/2018 Enhanced PDF handling&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;http://files.greenstone.org/tutorial/gs2-current/en/enhanced_pdf.htm 2/4&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;Splitting PDFs into sections&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;5. In the Document Plugins section of the Design panel, configure PDFPlugin. Switch on the use_sections option.&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;In the Search Indexes section, ensure that both the section and document boxes are checked. This will build the indexes on both the section&lt;br /&gt;level and the document level.&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;Build and preview the collection. View the text versions of some of the PDF documents. Note that these are now split into a series of pages,&lt;br /&gt;and a &amp;quot;go to page&amp;quot; box is provided. The format is still a bit ugly though, and pdf05-notext.pdf is still not processed.&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;Using image format&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;6. If conversion to HTML doesn't produce the result you'd like, PDF documents can be converted to a series of images, one per page. This&lt;br /&gt;requires ImageMagick and Ghostscript to be installed.&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;7. In the Document Plugins section, configure PDFPlugin. Set the convert_to option to one of the image types, e.g. pagedimg_jpg. Switch off&lt;br /&gt;the use_sections option, as it is not used with image conversion.&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;8. Build the collection and preview.All PDF documents (including pdf05-notext.pdf) have been processed and divided into sections, but each&lt;br /&gt;section displays &amp;quot;This document has no text.&amp;quot;. For the conversion to images for PDF documents, no text is extracted.&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;9. In order to view the documents properly, you will need to modify the format statement. In the Format Features section on the Format panel,&lt;br /&gt;select the DocumentText format statement. Replace&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;[Text]&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;with&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;[srcicon]&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;10. Preview the collection. Images from the document are now displayed instead of the extracted text. Both pdf05-notext.pdf and pdf06-&lt;br /&gt;weirdchars.pdf display nicely now.&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;In this collection, we only have PDF documents and they have all been converted to images. If we had other document types in the collection,&lt;br /&gt;we should use a different format statement, such as:&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;{If}{[parent:FileFormat] eq PDF,[srcicon],[Text]}&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;FileFormat is an extracted metadata item which shows the format of the source document. We can use this to test whether the documents are&lt;br /&gt;PDF or not: for PDF documents, display [srcicon], for other documents, display [Text].&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;Using process_exp to control document processing (advanced)&lt;/p&gt;&lt;br /&gt;&lt;br /&gt;&lt;/div&gt;&lt;/div&gt;&lt;br /&gt;&lt;a name=0&gt;&lt;/a&gt;&lt;div style=&quot;page-break-before:always; page-break-after:always&quot;&gt;&lt;div&gt;&lt;p&gt;11/13/2018 Enhanced PDF handling&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;http://files.greenstone.org/tutorial/gs2-current/en/enhanced_pdf.htm 3/4&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;11. Processing all of the PDF documents using an image type may not give the best result for your collection. The images will look nice, but as no&lt;br /&gt;text is extracted, searching the full text will not be available for these documents. The best solution would be to process most of the PDF files as&lt;br /&gt;HTML, and only use the image format where HTML doesn't work.&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;12. We achieve this by putting the problem files into a separate folder, and adding another PDFPlugin plugin with different options.&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;13. Go to the Gather panel. Make a new folder called &amp;quot;notext&amp;quot;: right click in the collection panel and select New folder from the menu. Change the&lt;br /&gt;Folder Name to &amp;quot;notext&amp;quot;, and click &amp;lt;OK&amp;gt;.&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;Move the two pdf files that have problems with html (pdf05-notext.pdf and pdf06-weirdchars.pdf) into this folder by drag and drop. We will set&lt;br /&gt;up the plugins so that PDF files in this notext folder are processed differently to the other PDF files.&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;14. Switch to the Document Plugins section of the Design panel. Add a second PDF plugin by selecting PDFPlugin from the Select plugin to&lt;br /&gt;add: drop-down list, and clicking &amp;lt;Add Plugin...&amp;gt;. This plugin will come after the first PDF plugin, so we configure it to process PDF&lt;br /&gt;documents as HTML. Set the convert_to option to html, and switch on the use_sections option. Click &amp;lt;OK&amp;gt;.&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;15. Configure the first PDF plugin, and set the process_exp option to &amp;quot;notext.*\\.pdf&amp;quot;.&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;16. The two PDF plugins should have options like the following:&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;plugin PDFPlugin -convert_to pagedimg_jpg -process_exp &amp;quot;notext.*\\.pdf&amp;quot;&lt;br /&gt; plugin PDFPlugin -convert_to html -use_sections&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;The paged_img version must come earlier in the list than the html version. The process_exp for the first PDFPlugin will process any PDF files&lt;br /&gt;in the notext directory. The second PDFPlugin will process any PDF files that are not processed by the first one.&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;Note that all plugins have the process_exp option, and this can be used to customize which documents are processed by which plugin.&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;17. Edit the DocumentText format statement. PDF files processed as HTML will not have images to display, so we need to make sure they get text&lt;br /&gt;displayed instead. Change [srcicon] to {If}{[NoText] eq &amp;quot;1&amp;quot;,[srcicon],[Text]}.&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;18. Build and preview the collection. All PDF documents should look relatively nice. Try searching this collection. You will be able to search for&lt;br /&gt;the PDFs that were converted to HTML (try e.g. &amp;quot;bibliography&amp;quot;), but not the ones that were converted to images (try searching for &amp;quot;FAO&amp;quot; or&lt;br /&gt;&amp;quot;METS&amp;quot;).&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;Opening PDF files with query terms highlighted&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;19. Next we'll customize the SearchVList format statement to highlight the query terms in a PDF file when it is opened from the search result list.&lt;br /&gt;This requires Acrobat Reader 7.0 version or higher, and currently only works on a Microsoft Windows platform.&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;20. The search terms are kept in the macro variable _queryterms_, and we append #search=&amp;quot;_queryterms_&amp;quot; to the end of a PDF file link to pass&lt;br /&gt;the query terms to the PDF.&lt;/p&gt;&lt;br /&gt;&lt;br /&gt;&lt;/div&gt;&lt;/div&gt;&lt;br /&gt;&lt;a name=0&gt;&lt;/a&gt;&lt;div style=&quot;page-break-before:always; page-break-after:always&quot;&gt;&lt;div&gt;&lt;p&gt;11/13/2018 Enhanced PDF handling&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;http://files.greenstone.org/tutorial/gs2-current/en/enhanced_pdf.htm 4/4&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;PDFPlugin saves each PDF file in a unique directory. You can use&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;_httpcollection_/index/assoc/[archivedir]/[srclinkFile]&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;to refer to these files.&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;21. Add SearchVList by selecting Search from the Choose Feature drop down list, and VList from the Affected Component list. Click &amp;lt;Add&lt;br /&gt;Format&amp;gt; to add the SearchVList format statement into the list of assigned formats. We need to test whether the file is a PDF file before linking&lt;br /&gt;to it, using {If}{[ex.FileFormat] eq 'PDF',,}. For PDF files, we use the above path format instead of the [ex.srclink] and [ex./srclink] variables to&lt;br /&gt;link to the file.&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;The resulting format statement is:&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;&amp;lt;td valign=&amp;quot;top&amp;quot;&amp;gt;[link][icon][/link]&amp;lt;/td&amp;gt;&lt;br /&gt; &amp;lt;td valign=&amp;quot;top&amp;quot;&amp;gt;{If}{[ex.FileFormat] eq 'PDF', &amp;lt;a href=\\&amp;quot;_httpcollection_/index/assoc/[archivedir]/[srclinkFile]#search=&amp;amp;quot;_queryterms_&amp;amp;quot;\\&amp;quot;&amp;gt;&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;{Or}{[ex.thumbicon],[ex.srcicon]}&amp;lt;/a&amp;gt;,&lt;br /&gt; [ex.srclink]{Or}{[ex.thumbicon],[ex.srcicon]}[ex./srclink]}&amp;lt;/td&amp;gt;&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt; &amp;lt;td valign=&amp;quot;top&amp;quot;&amp;gt;[highlight]&lt;br /&gt; {Or}{[dc.Title],[ex.Title],Untitled}&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt; [/highlight]{If}{[ex.Source],&amp;lt;br&amp;gt;&amp;lt;i&amp;gt;([ex.Source])&amp;lt;/i&amp;gt;}&amp;lt;/td&amp;gt;&lt;br /&gt; &lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;When the PDF icons are clicked in the search results, Acrobat will open the file with the search window open with the query terms highlighted.&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;Copyright © 2005-2016 by the New Zealand Digital Library Project at the University of Waikato, New Zealand&lt;br /&gt; Permission is granted to copy, distribute and/or modify this document under the terms of the GNU Free Documentation License, Version 1.2 or any&lt;br /&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;later version published by the Free Software Foundation; with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts. A copy of the&lt;br /&gt;license is included in the section entitled “GNU Free Documentation License.”&lt;/p&gt;&lt;br /&gt;&lt;br /&gt;&lt;/div&gt;&lt;/div&gt;&lt;br /&gt;</Content>
</Section>
</Archive>
